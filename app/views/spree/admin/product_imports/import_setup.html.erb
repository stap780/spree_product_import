<% content_for :page_actions do %>
  <%= external_page_preview_link(@product_import) %>
<% end %>

<%= render partial: 'spree/admin/shared/error_messages', locals: { target: @product_import } %>
<fieldset>
<p>We create new product if not found by Uniq field. We update product if found by Uniq field</p>
</fieldset>
<%= form_for [:admin, @product_import], method: :put, html: { multipart: true } do |f| %>
  <fieldset>
    <div class="row">
      <div class="form-group checkbox">
        <%= label_tag :active do %>
          <%= f.check_box :active %>
          <%= Spree.t(:active) %>
        <% end %>
      </div>
      <div data-hook="admin_product_uniq_field">
        <%= f.field_container :uniq_field do %>
          <%= f.label :uniq_field, Spree.t(:uniq_field) %>
          <%= collection_select(:product_import, :uniq_field, @uniq_fields, :id, :unique_name, {}, { multiple: false, class: '' }) %>
        <% end %>
      </div>
    </div>
    <div class="row mb-4">
        <div class="col-3"><b>System fields</b></div>
        <div class="col-5"><b>Columns from file</b></div>
    </div>
    <div class="row mb-4">
        <%= f.fields_for :product_import_columns do |ff| %>
          <% @header.each do |of| %> 
            <div class="row mb-1">
                <div class="col-3">
                  <% sys_val = ff.object.present? ? ff.object.column_file : of %>
                  <%= ff.hidden_field :column_file, value: sys_val %>
                  <% label_name = of == 'title' || of == 'id' ? t("helpers.label.#{key}.#{of}")+" (*required)" : t("helpers.label.#{key}.#{of}") %>
                  <%= label_tag "#{of}", label_name %>
                </div>
                <div class="col-5">
                  <%= ff.select :column_system, @our_fields, {}, { class: "form-select" }%>
                </div>
            </div>
          <% end %>
        <%end%>
    </div>
    <div class="row">
      <div class="form-group checkbox">
        <%= label_tag :update_title do %>
          <%= f.check_box :update_title %>
          <%= Spree.t(:update_title) %>
        <% end %>
      </div>
      <div class="form-group checkbox">
        <%= label_tag :update_desc do %>
          <%= f.check_box :update_desc %>
          <%= Spree.t(:update_desc) %>
        <% end %>
      </div>
      <div class="form-group checkbox">
        <%= label_tag :update_img do %>
          <%= f.check_box :update_img %>
          <%= Spree.t(:update_img) %>
        <% end %>
      </div>
      <div class="form-group checkbox">
        <%= label_tag :update_quantity do %>
          <%= f.check_box :update_quantity %>
          <%= Spree.t(:update_quantity) %>
        <% end %>
      </div>
      <div class="form-group checkbox">
        <%= label_tag :update_price do %>
          <%= f.check_box :update_price %>
          <%= Spree.t(:update_price) %>
        <% end %>
      </div>
    </div>
    <%= render partial: 'spree/admin/shared/edit_resource_links' %>
  </fieldset>
<% end %>
